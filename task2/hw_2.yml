---
- hosts: nodes
  vars:
   userlist:
    alice:
     email: Alice@example.com
     homedir: /home/alice
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35346539366465306665306537343935663635636565396366356236333963643664323566363164
          3635316366643936636633353936663430356563386236630a356439626534356331656261336131
          64353533356139373664393366306138306336633062306266623338643163356538386432633732
          3438313236383931620a326630316230633936383538363765323463396232353466373861393864
          3963
    bob:
     email: Bob@example.com
     homedir: /home/bob
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65656531363139653563316361626262336536356363663833393161363766663562333062613133
          6339366562633536623330663237613337373333666461380a643566303362366239333832346438
          39303266663566383731353164373363633965336463373937326331623137353262306338646164
          6630336534643061330a333464393730373761383862343037313734653465396535616465666162
          3931
    carol:
     email: Carol@example.com
     homedir: /home/carol
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30623963623564393339393737366136356638346533336138303139616362316430313766356365
          6238363035353266313930623330373665623964313536310a383233366464636265343138366561
          61633664316566333539373165626663656533306661353930666339373161633439353134376634
          3266366663343337310a663834363139636336313235386161336332333264316538623131656465
          3963
  tasks:
  - name: Adding users
    user:
      update_password: on_create
      create_home: yes
      state: present
      name: "{{item.key}}"
      comment: "{{item.value.email}}"
      home: "{{item.value.homedir}}"
      password: "{{item.value.password | password_hash('sha512')}}"
    with_dict: "{{ userlist }}"
